import{H as n,J as t}from"./index-smSU8IZZ.js";const e={startTimes:{},start(n){this.startTimes[n]=Date.now(),console.log(`⏱️ [${n}] 开始计时`)},end(n){if(!this.startTimes[n])return console.warn(`⚠️ [${n}] 未找到开始时间`),0;const t=Date.now()-this.startTimes[n];return console.log(`✅ [${n}] 完成，耗时: ${t}ms`),delete this.startTimes[n],t},getCurrentDuration(n){return this.startTimes[n]?Date.now()-this.startTimes[n]:(console.warn(`⚠️ [${n}] 未找到开始时间`),0)},measure(n,t){return async(...e)=>{this.start(t);try{const o=await n(...e);return this.end(t),o}catch(o){throw this.end(t),o}}}},o=n=>{const t=["内在力量和潜能","转变和新的开始","智慧和内在的声音","稳定和物质基础","选择和决策时刻","和谐与平衡","成功和成就","内在的平静和满足"];return t[Math.floor(Math.random()*t.length)]},s=(n,t=!0)=>{const e=t?["保持开放的心态，接受新的可能性","相信自己的直觉和判断","关注当下，不要过分担忧未来","寻求平衡，不要走向极端","勇敢面对挑战，这将带来成长","与重要的人保持沟通和联系","给自己一些时间和空间进行反思","采取具体行动，而不仅仅是计划"]:["注意不要过于冲动或鲁莽","避免过度分析导致的犹豫不决","警惕可能的误导或欺骗","不要忽视重要的细节或警告信号","避免过度依赖他人的意见","注意不要陷入消极思维模式","避免逃避责任或困难情况","不要让过去的失败阻碍你前进"];return e[Math.floor(Math.random()*e.length)]},r=()=>{const n=["转变和成长","反思和内省","决策和选择","稳定和巩固","挑战和机遇并存","收获和成就"];return n[Math.floor(Math.random()*n.length)]},a=()=>{const n=["带来新的机会和可能性","帮助你做出重要决定","让你收获之前努力的成果","虽有挑战，但最终会有所收获","引导你发现新的方向和目标","帮助你与重要的人建立更深层次的联系"];return n[Math.floor(Math.random()*n.length)]},c=async(n,t,e="",c="daily",i)=>{console.log(`开始生成塔罗牌解读: 类型=${c}, 牌阵=${t}, 问题=${e||"无"}`),console.log("抽取的牌:",n.map(n=>n.name).join(", "));let l="";"daily"===c?l+="**今日塔罗解读**\n\n":"quick"===c?l+="**快速塔罗解读**\n\n":"custom"===c&&(l+=`**定向塔罗解读: ${e}**\n\n`),"function"==typeof i&&(i(l),await new Promise(n=>setTimeout(n,500)));for(let r=0;r<n.length;r++){const t=n[r];let e="";"daily"===c||"quick"===c?e=0===r?"过去/问题根源":1===r?"现在/当前情况":"未来/可能结果":"custom"===c&&(e=0===r?"当前状况":1===r?"障碍或助力":"建议或结果"),l+=`**${e} - ${t.name}**\n\n`,l+=`${t.name}代表着${o(t.name)}。在${e}的位置，它${t.isUpright?"正位":"逆位"}显示${s(e,t.isUpright)}。\n\n`,"function"==typeof i&&(i(l),await new Promise(n=>setTimeout(n,500)))}return l+="**牌与牌之间的关系分析**\n\n",l+=`${n[0].name}与${n[1].name}的组合显示，你的过去经历正在影响当前的情况。${n.length>2?`而${n[2].name}则预示着可能的未来发展方向。`:""}\n\n`,"function"==typeof i&&(i(l),await new Promise(n=>setTimeout(n,500))),l+="**综合解读和建议**\n\n","daily"===c?l+=`今天是充满${r()}的一天。过去的经验已经为你奠定了基础，现在的情况虽有挑战但也蕴含机会，未来的发展取决于你今天的选择。保持积极的心态，相信自己的直觉，今天将会是富有成效的一天。\n\n`:"quick"===c?l+=`近期你可能会经历${r()}。这段时间里，重要的是保持平衡和专注，不要被短期的困难所干扰。接下来的发展将取决于你如何应对当前的挑战和机遇。\n\n`:"custom"===c&&(l+=`关于"${e}"，这三张牌共同表明，你正处于一个${r()}的阶段。当前的情况需要你${s("建议",!0)}，未来的发展将会${a()}。\n\n`),"function"==typeof i&&(i(l),await new Promise(n=>setTimeout(n,500))),l+="**具体建议**\n\n",l+=`1. ${s("建议",!0)}\n`,l+=`2. ${s("建议",!0)}\n`,l+=`3. ${s("建议",!0)}\n`,"function"==typeof i&&i(l),l},i={handleStreamResponse:async(n,e,o,s,r)=>{try{{console.log("使用标准fetch处理SSE");const s=await t(n,e);if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const c=s.body.getReader(),i=new TextDecoder;let l="";for(;;){const{done:n,value:t}=await c.read();if(n){console.log("SSE流结束"),r&&r();break}l+=i.decode(t,{stream:!0});const e=l.split("\n");l=e.pop()||"";for(const s of e)if(""!==s.trim()&&s.startsWith("data:"))try{const n=s.slice(5).trim();if("[DONE]"===n)continue;const t=JSON.parse(n);o&&o(t)}catch(a){console.error("解析SSE数据失败:",a,s)}}return{abort:()=>c.cancel()}}}catch(c){return console.error("SSE处理失败:",c),s&&s(c),r&&r(),{abort:()=>{}}}}},l="demo-key-for-build",m="https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions",u=(n,t,e,o,s)=>{const r=n.map((n,t)=>{let e="";return"daily"===o||"quick"===o?e=0===t?"过去/问题根源":1===t?"现在/当前情况":"未来/可能结果":"custom"===o&&(e=0===t?"当前状况":1===t?"障碍或助力":"建议或结果"),`${e}: ${n.name}(${n.isUpright?"正位":"逆位"}) - ${n.isUpright?n.uprightMeaning:n.reversedMeaning}`}).join("\n");let a="";"daily"===o?a="今日":"quick"===o?a="生活":"custom"===o&&(a=e);let c="";const i=s?`基础解读内容：\n${s}\n\n`:"";return console.log(`构建AI深度解读提示词: 类型=${o}, 牌阵=${t}, 问题=${a||"无"}`),"daily"===o?c=`请你作为一位专业的塔罗牌解读师和心理学专家，使用通义千问-Plus模型为我提供今日塔罗牌的深度AI解读。我抽到了以下三张牌:\n${r}\n\n${i}请基于以上信息，提供更深层次的心理学和象征意义分析，包括：\n1. 从心理学角度分析这些牌面组合反映的潜意识状态\n2. 提供更具体的行动建议和自我提升方向\n3. 分析可能面临的挑战和如何克服\n4. 提供一个简短的冥想或反思练习，帮助我更好地应用这个解读\n\n请使用专业但易于理解的语言，在输出文字中适当加入🧠💭🌈✨等小图标增加可读性，并使用Markdown格式，包括标题和分段。`:"quick"===o?c=`请你作为一位专业的塔罗牌解读师和心理学专家，使用通义千问-Plus模型为我提供生活问题的深度AI解读。我抽到了以下三张牌:\n${r}\n\n${i}请基于以上信息，提供更深层次的心理学和象征意义分析，包括：\n1. 从心理学角度分析这些牌面组合反映的潜意识状态\n2. 提供更具体的行动建议和自我提升方向\n3. 分析可能面临的挑战和如何克服\n4. 提供一个简短的冥想或反思练习，帮助我更好地应用这个解读\n\n请使用专业但易于理解的语言，在输出文字中适当加入🧠💭🌈✨等小图标增加可读性，并使用Markdown格式，包括标题和分段。`:"custom"===o&&(c=`请你作为一位专业的塔罗牌解读师和心理学专家，使用通义千问-Plus模型为我提供关于"${e}"的深度AI解读。我抽到了以下三张牌:\n${r}\n\n${i}请基于以上信息，提供更深层次的心理学和象征意义分析，包括：\n1. 从心理学角度分析这些牌面组合反映的潜意识状态\n2. 提供更具体的行动建议和自我提升方向\n3. 分析可能面临的挑战和如何克服\n4. 提供一个简短的冥想或反思练习，帮助我更好地应用这个解读\n\n请使用专业但易于理解的语言，在输出文字中适当加入🧠💭🌈✨等小图标增加可读性，并使用Markdown格式，包括标题和分段。`),c},h=async(n,o)=>{var s;const r={model:"qwen-plus",messages:[{role:"user",content:n}],stream:!0,max_tokens:2e3};try{if(e.start("AI解读API调用"),"function"==typeof o){const n=await $(r,o);return e.end("AI解读API调用"),n}{r.stream=!1,console.log("开始非流式调用通义千问API...");const n=await t(m,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`},body:JSON.stringify(r)});if(!n.ok){const t=await n.json();throw new Error(`通义千问API错误: ${(null==(s=t.error)?void 0:s.message)||n.statusText}`)}const o=(await n.json()).choices[0].message.content,a=e.end("AI解读API调用");return console.log(`✅ 非流式API调用完成，响应长度: ${o.length}字符，耗时: ${a}ms`),o}}catch(a){throw e.end("AI解读API调用"),a}},$=async(n,t)=>{let o="",s=0,r=0;try{e.start("AI解读API请求");const a={method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`},body:JSON.stringify(n)};e.start("AI解读流式输出");await i.handleStreamResponse(m,a,n=>{try{if(n.choices&&n.choices[0]&&n.choices[0].delta&&n.choices[0].delta.content){if(s++,1===s){r=Date.now();const n=e.end("AI解读API请求");console.log(`🚀 AI解读API连接成功，耗时: ${n}ms`),console.log(`⚡ 首个AI解读内容块接收，耗时: ${r-e.startTimes["AI解读流式输出"]}ms`)}const a=n.choices[0].delta.content;o+=a,"function"==typeof t&&t(o)}}catch(a){console.error("处理SSE消息失败:",a)}},n=>{console.error("SSE流处理错误:",n),e.end("AI解读API请求"),e.end("AI解读流式输出")},()=>{const n=e.end("AI解读流式输出");console.log(`✨ AI解读流式输出完成，共接收${s}个内容块，总耗时: ${n}ms`)});return await new Promise(n=>setTimeout(n,500)),o}catch(a){throw console.error("流式调用通义千问API失败:",a),e.end("AI解读API请求"),e.end("AI解读流式输出"),a}},d={generateAIInsight:async(n,t,o="",s="daily",r="",a)=>{console.log(`开始生成AI深度解读: 类型=${s}, 牌阵=${t}, 问题=${o||"无"}`),console.log("抽取的牌:",n.map(n=>n.name).join(", "));const i=u(n,t,o,s,r);try{0;const r="function"==typeof a?((n,t=100)=>{let e=0,o=null,s="";return r=>{const a=Date.now();s=r,a-e>=t?(e=a,n(r)):(clearTimeout(o),o=setTimeout(()=>{e=Date.now(),n(s)},t))}})(a,80):null;e.start("AI深度解读");try{const n=await h(i,r),t=e.end("AI深度解读");return console.log(`✅ AI深度解读生成完成，总耗时: ${t}ms，内容长度: ${n.length}字符`),n}catch(l){console.error("通义千问API调用失败，使用本地模拟服务作为备选:",l),console.log("使用本地模拟服务生成AI深度解读...");const a=await c(n,t,o,s,r),i=e.end("AI深度解读");return console.log(`✅ 本地模拟AI深度解读生成完成，总耗时: ${i}ms，内容长度: ${a.length}字符`),a}}catch(m){throw console.error("AI深度解读生成失败:",m),e.end("AI深度解读"),new Error(`AI深度解读生成失败: ${m.message}`)}}};export{d as a,e as p};
