import{c as s,w as t,m as e,r as a,i,o as n,f as r,l as o,k as l,p as c,j as u,q as p,t as m,S as d,u as h}from"./index-D6euLAw-.js";import{a as g}from"./ai-insight-service.C3Q3b0vJ.js";import{_ as f}from"./_plugin-vue_export-helper.BCo6x5W8.js";const _=f({onLoad(){e({url:"/pages/login/login",fail:s=>{console.error("重定向到登录页面失败:",s),a({url:"/pages/login/login"})}})},data:()=>({apiStatus:"idle",statusText:"未测试",responseContent:"",formattedResponse:"",metrics:{firstChunkTime:0,totalTime:0,chunkCount:0},startTime:0}),methods:{async testQianwenAPI(){this.apiStatus="loading",this.statusText="测试中...",this.responseContent="",this.formattedResponse="",this.metrics={firstChunkTime:0,totalTime:0,chunkCount:0},this.startTime=Date.now();let s=!1,t=0;try{const e=[{name:"愚者",isUpright:!0,uprightMeaning:"新的开始，冒险，无忧无虑",reversedMeaning:"鲁莽，冒险，愚蠢的决定",position:"过去/问题根源"},{name:"魔术师",isUpright:!0,uprightMeaning:"创造力，技能，专注",reversedMeaning:"操纵，欺骗，才能浪费",position:"现在/当前情况"},{name:"高priestess",isUpright:!1,uprightMeaning:"直觉，潜意识，神圣女性",reversedMeaning:"秘密，断开连接，表面知识",position:"未来/可能结果"}];await g.generateAIInsight(e,"general","今日运势如何？","daily","基础解读内容：今天的牌面显示你正处于一个新的开始阶段，充满创造力，但需要注意直觉的指引。",e=>{s||(this.metrics.firstChunkTime=Date.now()-this.startTime,s=!0),t++,this.metrics.chunkCount=t,this.responseContent=e,this.formatResponse(e)}),this.metrics.totalTime=Date.now()-this.startTime,this.apiStatus="success",this.statusText="测试成功"}catch(e){console.error("API测试失败:",e),this.apiStatus="error",this.statusText=`测试失败: ${e.message}`,this.responseContent=`错误信息: ${e.message}`,this.formatResponse(this.responseContent)}},formatResponse(s){try{let t=s.replace(/^#\s+(.+)$/gm,"<h3>$1</h3>").replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*([^\*]+)\*/g,"<em>$1</em>").replace(/^(\d+\.\s+)(.*?)$/gm,"<li>$2</li>").replace(/^-\s+(.*?)$/gm,"<li>$1</li>").replace(/\n\n/g,"</p><p>").replace(/\n/g,"<br>");t.startsWith("<p>")||t.startsWith("<h3>")||(t="<p>"+t),t.endsWith("</p>")||(t+="</p>"),t=t.replace(/(<li>.*?<\/li>)+/g,"<ul>$&</ul>"),this.formattedResponse=t}catch(t){console.error("格式化响应内容出错:",t),this.formattedResponse="<p>"+s.replace(/\n/g,"<br>")+"</p>"}}}},[["render",function(e,a,g,f,_,T){const C=o,k=i,$=u,I=h,S=d;return n(),s(k,{class:"api-test-container"},{default:t(()=>[r(k,{class:"header"},{default:t(()=>[r(C,{class:"title"},{default:t(()=>[l("网页版API测试页面")]),_:1}),r(C,{class:"subtitle"},{default:t(()=>[l("测试通义千问API流式解读功能")]),_:1})]),_:1}),r(k,{class:"test-section"},{default:t(()=>[r($,{class:"test-button",onClick:T.testQianwenAPI},{default:t(()=>[l("测试通义千问API")]),_:1},8,["onClick"]),r(k,{class:p(["status",{success:"success"===_.apiStatus,error:"error"===_.apiStatus,loading:"loading"===_.apiStatus}])},{default:t(()=>[l(" 状态: "+m(_.statusText),1)]),_:1},8,["class"]),_.responseContent||"loading"===_.apiStatus?(n(),s(k,{key:0,class:"response-container"},{default:t(()=>[r(C,{class:"response-title"},{default:t(()=>[l("API响应:")]),_:1}),"loading"===_.apiStatus?(n(),s(k,{key:0,class:"loading-indicator"},{default:t(()=>[r(k,{class:"loading-dots"},{default:t(()=>[r(k,{class:"dot"}),r(k,{class:"dot"}),r(k,{class:"dot"})]),_:1})]),_:1})):c("",!0),r(S,{class:"response-content","scroll-y":""},{default:t(()=>[r(I,{nodes:_.formattedResponse},null,8,["nodes"])]),_:1})]),_:1})):c("",!0),_.metrics.totalTime>0?(n(),s(k,{key:1,class:"metrics"},{default:t(()=>[r(C,{class:"metrics-title"},{default:t(()=>[l("性能指标:")]),_:1}),r(k,{class:"metrics-item"},{default:t(()=>[r(C,null,{default:t(()=>[l("首次响应时间: "+m(_.metrics.firstChunkTime)+"ms",1)]),_:1})]),_:1}),r(k,{class:"metrics-item"},{default:t(()=>[r(C,null,{default:t(()=>[l("总响应时间: "+m(_.metrics.totalTime)+"ms",1)]),_:1})]),_:1}),r(k,{class:"metrics-item"},{default:t(()=>[r(C,null,{default:t(()=>[l("内容块数量: "+m(_.metrics.chunkCount),1)]),_:1})]),_:1})]),_:1})):c("",!0)]),_:1})]),_:1})}],["__scopeId","data-v-7b94ed8b"]]);export{_ as default};
