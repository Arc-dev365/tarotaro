import{z as t,A as e,v as a,b as r,d as s,c as i,w as o,i as n,o as d,f as l,p as c,k as h,t as g,j as u,x as m,F as y,y as f,g as p,q as w,l as R,B as S}from"./index-D6euLAw-.js";import{d as _,s as C,a as T}from"./share-save-utils.D_HH1R20.js";import{p as D,a as k}from"./ai-insight-service.C3Q3b0vJ.js";import{T as $,a as v}from"./TarotReading.Q5-8oYaX.js";import{_ as I}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{_ as H}from"./start.CamMrkbd.js";const x=t("tarot",{state:()=>({currentCards:[],currentReading:"",formattedReading:"",history:{},isDrawing:!1,isReading:!1,drawingProgress:0,currentDate:"",hasTodayReading:!1,refreshTimeText:""}),getters:{todayReading:t=>{const e=(new Date).toISOString().split("T")[0];return t.history[e]||null},sortedHistory:t=>Object.entries(t.history).sort(([t],[e])=>new Date(e)-new Date(t)).map(([t,e])=>({date:t,...e}))},actions:{setCurrentDate(){const t=new Date,e=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0");this.currentDate=`${e}å¹´${a}æœˆ${r}æ—¥`},checkTodayReading(){this.loadHistory();const t=(new Date).toISOString().split("T")[0];this.history[t]?(this.hasTodayReading=!0,this.calculateRefreshTime()):this.hasTodayReading=!1},calculateRefreshTime(){const t=new Date,e=new Date(t);e.setDate(e.getDate()+1),e.setHours(0,0,0,0);const a=e-t,r=Math.floor(a/36e5),s=Math.floor(a%36e5/6e4);this.refreshTimeText=`${r}å°æ—¶${s}åˆ†é’Ÿåå¯é‡æ–°æŠ½å–`},async startDrawing(){if(!this.isDrawing)return this.isDrawing=!0,this.drawingProgress=0,this.currentCards=[],new Promise(t=>{const e=setInterval(()=>{this.drawingProgress+=5;const a=this.currentCards.map(t=>t.id);this.drawingProgress>=33&&this.currentCards.length<1||this.drawingProgress>=66&&this.currentCards.length<2?this.currentCards.push(this.drawMajorArcanaCard(a)):this.drawingProgress>=100&&(this.currentCards.push(this.drawMajorArcanaCard(a)),clearInterval(e),setTimeout(()=>{this.isDrawing=!1,t()},500))},100)})},drawMajorArcanaCard:(t=[])=>_(1,t,"major")[0],async startReading(){this.isReading=!0,this.currentReading="",this.formattedReading='<div id="streaming-content"></div>',D.start("ä»Šæ—¥å¡”ç½—è§£è¯»"),this.formatReading();try{console.log("æ­£åœ¨ä½¿ç”¨åç«¯AIæœåŠ¡ç”Ÿæˆè§£è¯»...");const t=await k.generateAIInsight(this.currentCards,"threeCard","ä»Šæ—¥è¿åŠ¿","daily","",t=>{this.currentReading=t,this.formatReading()});if(t&&t.includes("å¾ˆæŠ±æ­‰ï¼Œè§£è¯»ç”Ÿæˆå¤±è´¥"))throw console.error("æ£€æµ‹åˆ°é”™è¯¯æ¶ˆæ¯:",t),new Error("åç«¯AIæœåŠ¡ç”Ÿæˆè§£è¯»å¤±è´¥");const e=D.end("ä»Šæ—¥å¡”ç½—è§£è¯»");console.log(`âœ… ä»Šæ—¥å¡”ç½—è§£è¯»ç”Ÿæˆå®Œæˆï¼Œæ€»è€—æ—¶: ${e}msï¼Œå†…å®¹é•¿åº¦: ${t.length}å­—ç¬¦`),this.saveTodayReading(),this.isReading=!1}catch(t){throw console.error("åç«¯AIæœåŠ¡ç”Ÿæˆè§£è¯»å¤±è´¥:",t),D.end("ä»Šæ—¥å¡”ç½—è§£è¯»"),s({title:`AIè§£è¯»å¤±è´¥: ${t.message}`,icon:"none",duration:3e3}),this.currentReading="",t}},formatReading(){if(D.start("æ ¼å¼åŒ–è§£è¯»"),!this.currentReading||""===this.currentReading.trim())return this.formattedReading='<div id="streaming-content"></div>',void D.end("æ ¼å¼åŒ–è§£è¯»");let t=this.currentReading.replace(/^#\s+(.+)$/gm,"<h3>$1</h3>").replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*([^\*]+)\*/g,"<em>$1</em>").replace(/^(\d+\.\s+)(.*?)$/gm,"<li>$2</li>").replace(/^-\s+(.+)$/gm,"<li>$1</li>").replace(/\n\n/g,"</p><p>").replace(/\n/g,"<br>");t.startsWith("<h3>")||t.startsWith("<p>")||(t="<p>"+t),t.endsWith("</p>")||(t+="</p>"),t=t.replace(/(<li>.*?<\/li>)+/g,"<ul>$&</ul>"),this.formattedReading=t,D.end("æ ¼å¼åŒ–è§£è¯»")},saveTodayReading(){const t=(new Date).toISOString().split("T")[0];this.history[t]={date:this.currentDate,cards:this.currentCards,reading:this.currentReading},this.saveHistory(),this.hasTodayReading=!0,this.calculateRefreshTime()},saveHistory(){r("tarot_history",this.history)},loadHistory(){const t=a("tarot_history");t&&(this.history=t)},clearHistory(){this.history={},e("tarot_history")},resetToInitial(){this.currentCards=[],this.currentReading="",this.formattedReading="",this.isDrawing=!1,this.isReading=!1,this.drawingProgress=0}}});const P=I({components:{TarotDrawing:v,TarotReading:$,TarotHistory:I({name:"TarotHistory",props:{title:{type:String,default:"å†å²è®°å½•"},historyItems:{type:Array,default:()=>[]},emptyText:{type:String,default:"æš‚æ— å†å²è®°å½•"},showClearButton:{type:Boolean,default:!0}},data:()=>({showConfirmDialog:!1}),computed:{isEmpty(){return!this.historyItems||0===this.historyItems.length}},methods:{getPreviewText(t){if(D.start("é¢„è§ˆæ–‡æœ¬å¤„ç†"),!t)return D.end("é¢„è§ˆæ–‡æœ¬å¤„ç†"),"æ— è§£è¯»å†…å®¹";try{const e=t.replace(/^#\s+(.+)$/gm,"$1").replace(/\*\*(.*?)\*\*/g,"$1").replace(/\*([^\*]+)\*/g,"$1").replace(/^(\d+\.\s+|-\s+)(.*?)$/gm,"$2").replace(/\n/g," "),a=e.length>30?e.substring(0,30)+"...":e,r=D.end("é¢„è§ˆæ–‡æœ¬å¤„ç†");return console.log(`ğŸ“„ é¢„è§ˆæ–‡æœ¬å¤„ç†å®Œæˆï¼Œè€—æ—¶: ${r}ms`),a}catch(e){return console.error("å¤„ç†é¢„è§ˆæ–‡æœ¬å‡ºé”™:",e),D.end("é¢„è§ˆæ–‡æœ¬å¤„ç†"),t.substring(0,30)+"..."}},selectItem(t,e){D.start("å†å²è®°å½•é€‰æ‹©"),this.$emit("select",t,e);const a=D.end("å†å²è®°å½•é€‰æ‹©");console.log(`ğŸ“œ å†å²è®°å½•é€‰æ‹©å®Œæˆï¼Œè€—æ—¶: ${a}ms`)},confirmClear(){this.showConfirmDialog=!0},clearHistory(){this.$emit("clear"),this.showConfirmDialog=!1}}},[["render",function(t,e,a,r,s,S){const _=n,C=u,T=p,D=R;return d(),i(_,{class:"tarot-history"},{default:o(()=>[l(_,{class:"history-header"},{default:o(()=>[l(_,{class:"history-title"},{default:o(()=>[h(g(a.title),1)]),_:1}),a.showClearButton?(d(),i(_,{key:0,class:"history-actions"},{default:o(()=>[l(C,{class:"clear-btn",onClick:S.confirmClear},{default:o(()=>[h("æ¸…é™¤å†å²")]),_:1},8,["onClick"])]),_:1})):c("",!0)]),_:1}),S.isEmpty?(d(),i(_,{key:0,class:"history-empty"},{default:o(()=>[l(_,{class:"empty-text"},{default:o(()=>[h(g(a.emptyText),1)]),_:1})]),_:1})):(d(),i(_,{key:1,class:"history-list"},{default:o(()=>[(d(!0),m(y,null,f(a.historyItems,(t,e)=>(d(),i(_,{class:"history-item",key:e,onClick:a=>S.selectItem(t,e)},{default:o(()=>[l(_,{class:"item-date"},{default:o(()=>[h(g(t.date),1)]),_:2},1024),l(_,{class:"item-cards"},{default:o(()=>[(d(!0),m(y,null,f(t.cards,(t,e)=>(d(),i(_,{class:"mini-card",key:e},{default:o(()=>[l(T,{class:w(["mini-card-image",{"reversed-image":!1===t.isUpright}]),src:t.img,mode:"aspectFit"},null,8,["src","class"])]),_:2},1024))),128))]),_:2},1024),l(_,{class:"item-preview"},{default:o(()=>[h(g(S.getPreviewText(t.reading)),1)]),_:2},1024),l(_,{class:"item-arrow"},{default:o(()=>[l(D,{class:"arrow-icon"},{default:o(()=>[h("â€º")]),_:1})]),_:1})]),_:2},1032,["onClick"]))),128))]),_:1})),s.showConfirmDialog?(d(),i(_,{key:2,class:"confirm-dialog"},{default:o(()=>[l(_,{class:"dialog-content"},{default:o(()=>[l(_,{class:"dialog-title"},{default:o(()=>[h("ç¡®è®¤æ¸…é™¤")]),_:1}),l(_,{class:"dialog-message"},{default:o(()=>[h("ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰å†å²è®°å½•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚")]),_:1}),l(_,{class:"dialog-buttons"},{default:o(()=>[l(C,{class:"cancel-btn",onClick:e[0]||(e[0]=t=>s.showConfirmDialog=!1)},{default:o(()=>[h("å–æ¶ˆ")]),_:1}),l(C,{class:"confirm-btn",onClick:S.clearHistory},{default:o(()=>[h("ç¡®è®¤æ¸…é™¤")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})):c("",!0)]),_:1})}],["__scopeId","data-v-5d060d40"]])},data:()=>({showHistory:!1,cardPositions:["è¿‡å»/æ ¹æº","ç°åœ¨/æƒ…å†µ","æœªæ¥/ç»“æœ"]}),computed:{tarotStore:()=>x()},onLoad(){this.tarotStore.setCurrentDate(),this.tarotStore.checkTodayReading()},onShow(){this.tarotStore.checkTodayReading(),this.tarotStore.hasTodayReading||this.tarotStore.resetToInitial()},methods:{async handleDeckClick(){if(!this.tarotStore.isDrawing&&!this.tarotStore.hasTodayReading){D.start("å¡”ç½—å®Œæ•´ä½“éªŒ");try{await this.tarotStore.startDrawing(),await this.startReading();const t=D.end("å¡”ç½—å®Œæ•´ä½“éªŒ");console.log(`ğŸ‰ å¡”ç½—å®Œæ•´ä½“éªŒç»“æŸï¼Œæ€»è€—æ—¶: ${t}ms`)}catch(t){D.end("å¡”ç½—å®Œæ•´ä½“éªŒ"),console.error("å¡”ç½—ä½“éªŒè¿‡ç¨‹å‡ºé”™:",t)}}},async startReading(){D.start("ä»Šæ—¥å¡”ç½—å®Œæ•´æµç¨‹");try{await this.tarotStore.startReading();const t=D.end("ä»Šæ—¥å¡”ç½—å®Œæ•´æµç¨‹");console.log(`âœ… ä»Šæ—¥å¡”ç½—å®Œæ•´æµç¨‹ç»“æŸï¼Œæ€»è€—æ—¶: ${t}ms`)}catch(t){D.end("ä»Šæ—¥å¡”ç½—å®Œæ•´æµç¨‹"),console.error("å¡”ç½—è§£è¯»è¿‡ç¨‹å‡ºé”™:",t)}},async shareReading(){try{const t={title:"ä»Šæ—¥å¡”ç½—è§£è¯»",date:this.tarotStore.currentDate,cards:this.tarotStore.currentCards,content:this.tarotStore.currentReading,question:"ä»Šæ—¥è¿åŠ¿"};await T(t)}catch(t){console.error("åˆ†äº«å¤±è´¥:",t),s({title:"åˆ†äº«å¤±è´¥",icon:"none",duration:2e3})}},saveReading(){try{const t={title:"ä»Šæ—¥å¡”ç½—è§£è¯»",date:this.tarotStore.currentDate,cards:this.tarotStore.currentCards,content:this.tarotStore.currentReading,question:"ä»Šæ—¥è¿åŠ¿",type:"daily"};C(t)}catch(t){console.error("ä¿å­˜å¤±è´¥:",t),s({title:"ä¿å­˜å¤±è´¥",icon:"none",duration:2e3})}},selectHistoryItem(t){D.start("åŠ è½½å†å²è§£è¯»");try{this.tarotStore.currentCards=t.cards,this.tarotStore.currentReading=t.reading,this.tarotStore.formatReading();const e=D.end("åŠ è½½å†å²è§£è¯»");console.log(`ğŸ“œ å†å²è§£è¯»åŠ è½½å®Œæˆï¼Œè€—æ—¶: ${e}ms`)}catch(e){D.end("åŠ è½½å†å²è§£è¯»"),console.error("åŠ è½½å†å²è§£è¯»å‡ºé”™:",e)}this.showHistory=!1}}},[["render",function(t,e,a,r,s,u){const m=n,y=R,f=p,_=S("TarotDrawing"),C=S("TarotReading"),T=S("TarotHistory");return d(),i(m,{class:"daily-container"},{default:o(()=>[l(m,{class:"header"},{default:o(()=>[l(m,{class:"title"},{default:o(()=>[h("ä»Šæ—¥å¡”ç½—")]),_:1}),l(m,{class:"subtitle"},{default:o(()=>[h("æ¯æ—¥è¿åŠ¿æŒ‡å¼•")]),_:1})]),_:1}),u.tarotStore.isDrawing||u.tarotStore.isReading||u.tarotStore.currentReading?c("",!0):(d(),i(m,{key:0,class:"content"},{default:o(()=>[l(m,{class:"instruction"},{default:o(()=>[l(m,{class:"instruction-title"},{default:o(()=>[h("ä»Šæ—¥å¡”ç½—è§£è¯»")]),_:1}),l(m,{class:"instruction-text"},{default:o(()=>[h("é€šè¿‡å¡”ç½—ç‰Œäº†è§£ä»Šå¤©çš„è¿åŠ¿å’ŒæŒ‡å¼•ã€‚æ¯å¤©åªèƒ½æŠ½å–ä¸€æ¬¡ï¼Œç»“æœå°†ä¿å­˜è‡³æ˜å¤©ã€‚")]),_:1})]),_:1}),l(m,{class:"date-display"},{default:o(()=>[l(m,{class:"current-date"},{default:o(()=>[h(g(u.tarotStore.currentDate),1)]),_:1}),u.tarotStore.hasTodayReading?(d(),i(m,{key:0,class:"time-remaining"},{default:o(()=>[l(y,null,{default:o(()=>[h("ä»Šæ—¥å·²æŠ½å–")]),_:1}),l(y,{class:"refresh-time"},{default:o(()=>[h(g(u.tarotStore.refreshTimeText),1)]),_:1})]),_:1})):c("",!0)]),_:1}),l(m,{class:w(["card-deck",{disabled:u.tarotStore.isDrawing||u.tarotStore.hasTodayReading}]),onClick:u.handleDeckClick},{default:o(()=>[l(f,{class:"start-image",src:H,mode:"aspectFit"}),l(m,{class:"deck-text"},{default:o(()=>[h(g(u.tarotStore.hasTodayReading?"æŸ¥çœ‹ä»Šæ—¥è§£è¯»":"ç‚¹å‡»æŠ½ç‰Œ"),1)]),_:1})]),_:1},8,["onClick","class"])]),_:1})),u.tarotStore.isDrawing?(d(),i(_,{key:1,isDrawing:u.tarotStore.isDrawing,drawingText:"æ­£åœ¨æ´—ç‰Œ...",drawnCards:u.tarotStore.currentCards,progress:u.tarotStore.drawingProgress,cardCount:3},null,8,["isDrawing","drawingText","drawnCards","progress"])):c("",!0),u.tarotStore.isReading||u.tarotStore.currentReading?(d(),i(C,{key:2,title:"ä»Šæ—¥å¡”ç½—è§£è¯»",date:u.tarotStore.currentDate,cards:u.tarotStore.currentCards,positions:s.cardPositions,content:u.tarotStore.formattedReading,isFormatted:!0,loading:u.tarotStore.isReading,loadingText:"æ­£åœ¨è§£è¯»å¡”ç½—ç‰Œ...",onShare:u.shareReading,onSave:u.saveReading},null,8,["date","cards","positions","content","loading","loadingText","onShare","onSave"])):c("",!0),s.showHistory?(d(),i(m,{key:3,class:"history-modal"},{default:o(()=>[l(m,{class:"modal-overlay",onClick:e[0]||(e[0]=t=>s.showHistory=!1)}),l(m,{class:"modal-content"},{default:o(()=>[l(m,{class:"modal-header"},{default:o(()=>[l(m,{class:"modal-title"},{default:o(()=>[h("å†å²è§£è¯»è®°å½•")]),_:1}),l(m,{class:"modal-close",onClick:e[1]||(e[1]=t=>s.showHistory=!1)},{default:o(()=>[h("Ã—")]),_:1})]),_:1}),l(T,{historyItems:u.tarotStore.sortedHistory,onSelect:u.selectHistoryItem,onClear:u.tarotStore.clearHistory},null,8,["historyItems","onSelect","onClear"])]),_:1})]),_:1})):c("",!0)]),_:1})}],["__scopeId","data-v-39062049"]]);export{P as default};
