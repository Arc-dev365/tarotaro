import{c as a,w as s,d as e,v as t,b as i,i as n,o as r,f as d,p as l,k as c,j as o,l as g,x as u,F as h,y as f,g as p,q as m,t as R,u as _}from"./index-D6euLAw-.js";import{s as C,a as v,d as w}from"./share-save-utils.D_HH1R20.js";import{p as k,a as y}from"./ai-insight-service.C3Q3b0vJ.js";import{_ as $}from"./_plugin-vue_export-helper.BCo6x5W8.js";const D=$({data:()=>({isLoading:!1,isReading:!1,drawnCards:[],readingResult:"",formattedReading:"",currentDate:""}),onLoad(){this.setCurrentDate()},onShow(){this.resetReading(),this.isLoading=!1,this.isReading=!1},methods:{setCurrentDate(){const a=new Date,s=a.getFullYear(),e=String(a.getMonth()+1).padStart(2,"0"),t=String(a.getDate()).padStart(2,"0");this.currentDate=`${s}年${e}月${t}日`},startQuickReading(){if(this.isLoading)return;this.isLoading=!0,this.isReading=!0,this.drawnCards=[],this.drawnCards.push(w(1)[0]);const a=this.drawnCards.map(a=>a.id);this.drawnCards.push(w(1,a)[0]);const s=this.drawnCards.map(a=>a.id);this.drawnCards.push(w(1,s)[0]),this.readingResult="",this.formattedReading='<div id="streaming-content"></div>',k.start("快速塔罗解读"),this.formattedReading='<div class="loading-message">正在连接AI服务...</div>',this.generateReading()},async generateReading(){try{const a=await y.generateAIInsight(this.drawnCards,"threeCard","","quick","",a=>{this.readingResult=a,this.formatReading()});if(a&&a.includes("很抱歉，解读生成失败"))throw console.error("检测到错误消息:",a),new Error("AI服务生成解读失败");const s=k.end("快速塔罗解读");console.log(`✅ 快速塔罗解读生成完成，总耗时: ${s}ms，内容长度: ${a.length}字符`),this.formatReading(),this.saveToRecentReadings(),this.isReading=!1,this.isLoading=!1}catch(a){console.error("解读生成失败:",a),k.end("快速塔罗解读"),e({title:`AI解读失败: ${a.message}`,icon:"none",duration:3e3}),this.readingResult="",this.formattedReading='<div class="error-message">AI解读生成失败，请稍后重试</div>',this.isReading=!1,this.isLoading=!1}},formatReading(){if(k.start("格式化"),!this.readingResult)return this.formattedReading='<div class="loading-message">正在生成解读...</div>',void k.end("格式化");let a=this.readingResult.replace(/^#\s+(.+)$/gm,"<h3>$1</h3>").replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*([^\*]+)\*/g,"<em>$1</em>").replace(/^-\s+(.+)$/gm,"<li>$1</li>").replace(/\n\n/g,"</p><p>").replace(/\n/g,"<br>");a.startsWith("<h3>")||a.startsWith("<p>")||(a="<p>"+a),a.endsWith("</p>")||(a+="</p>"),a=a.replace(/(<li>.*?<\/li>)+/g,"<ul>$&</ul>"),this.formattedReading=a,k.end("格式化")},saveToRecentReadings(){const a=t("recent_readings")||[];a.unshift({id:Date.now().toString(),date:this.currentDate,type:"快速塔罗",question:"近期运势",cards:this.drawnCards,reading:this.readingResult}),a.length>10&&a.pop(),i("recent_readings",a)},async shareReading(){try{const a={title:"快速塔罗解读",date:this.currentDate,cards:this.drawnCards,content:this.readingResult,question:"近期运势"};await v(a)}catch(a){console.error("分享失败:",a),e({title:"分享失败",icon:"none",duration:2e3})}},saveReading(){try{const a={title:"快速塔罗解读",date:this.currentDate,cards:this.drawnCards,content:this.readingResult,question:"近期运势",type:"quick"};C(a)}catch(a){console.error("保存失败:",a),e({title:"保存失败",icon:"none",duration:2e3})}},resetReading(){this.readingResult="",this.drawnCards=[],this.formattedReading=""}}},[["render",function(e,t,i,C,v,w){const k=n,y=g,$=o,D=p,b=_;return r(),a(k,{class:"quick-container"},{default:s(()=>[d(k,{class:"header"},{default:s(()=>[d(k,{class:"title"},{default:s(()=>[c("快速塔罗")]),_:1}),d(k,{class:"subtitle"},{default:s(()=>[c("快速解读近期运势")]),_:1})]),_:1}),v.isReading||v.readingResult?l("",!0):(r(),a(k,{key:0,class:"content"},{default:s(()=>[d(k,{class:"instruction"},{default:s(()=>[d(k,{class:"instruction-title"},{default:s(()=>[c("快速塔罗解读")]),_:1}),d(k,{class:"instruction-text"},{default:s(()=>[c("跳过抽牌过程，直接获取三张牌的解读，了解近期可能发生的事情和建议。")]),_:1})]),_:1}),d($,{class:"start-btn",onClick:w.startQuickReading,disabled:v.isLoading},{default:s(()=>[v.isLoading?(r(),a(y,{key:1},{default:s(()=>[c("解读中...")]),_:1})):(r(),a(y,{key:0},{default:s(()=>[c("开始快速解读")]),_:1}))]),_:1},8,["onClick","disabled"])]),_:1})),v.isReading?(r(),a(k,{key:1,class:"reading-container"},{default:s(()=>[d(k,{class:"reading-text"},{default:s(()=>[c("正在生成快速解读...")]),_:1}),d(k,{class:"cards-display"},{default:s(()=>[(r(!0),u(h,null,f(v.drawnCards,(e,t)=>(r(),a(k,{class:"card-item",key:t},{default:s(()=>[d(D,{class:m(["card-image",{"reversed-image":!1===e.isUpright}]),src:e.img||"/static/tarot/major/0-愚者.jpg",mode:"aspectFit"},null,8,["src","class"]),d(k,{class:"card-name"},{default:s(()=>[c(R(e.name),1)]),_:2},1024),d(k,{class:m(["card-orientation",{reversed:!1===e.isUpright}])},{default:s(()=>[c(R(e.isUpright?"正位":"逆位"),1)]),_:2},1032,["class"]),d(k,{class:"card-position"},{default:s(()=>[c(R(0===t?"过去/根源":1===t?"现在/情况":"未来/结果"),1)]),_:2},1024)]),_:2},1024))),128))]),_:1}),d(k,{class:"loading-dots"},{default:s(()=>[d(k,{class:"dot"}),d(k,{class:"dot"}),d(k,{class:"dot"})]),_:1})]),_:1})):l("",!0),v.readingResult?(r(),a(k,{key:2,class:"result-container"},{default:s(()=>[d(k,{class:"result-header"},{default:s(()=>[d(k,{class:"result-title"},{default:s(()=>[c("快速塔罗解读")]),_:1}),d(k,{class:"result-date"},{default:s(()=>[c(R(v.currentDate),1)]),_:1})]),_:1}),d(k,{class:"cards-display"},{default:s(()=>[(r(!0),u(h,null,f(v.drawnCards,(e,t)=>(r(),a(k,{class:"card-item",key:t},{default:s(()=>[d(D,{class:m(["card-image",{"reversed-image":!1===e.isUpright}]),src:e.img||"/static/tarot/major/0-愚者.jpg",mode:"aspectFit"},null,8,["src","class"]),d(k,{class:"card-name"},{default:s(()=>[c(R(e.name),1)]),_:2},1024),d(k,{class:m(["card-orientation",{reversed:!1===e.isUpright}])},{default:s(()=>[c(R(e.isUpright?"正位":"逆位"),1)]),_:2},1032,["class"]),d(k,{class:"card-position"},{default:s(()=>[c(R(0===t?"过去/根源":1===t?"现在/情况":"未来/结果"),1)]),_:2},1024)]),_:2},1024))),128))]),_:1}),d(k,{class:"reading-text"},{default:s(()=>[d(b,{nodes:v.formattedReading},null,8,["nodes"])]),_:1}),d(k,{class:"action-buttons"},{default:s(()=>[d($,{class:"share-btn",onClick:w.shareReading},{default:s(()=>[c("分享解读")]),_:1},8,["onClick"]),d($,{class:"save-btn",onClick:w.saveReading},{default:s(()=>[c("保存解读")]),_:1},8,["onClick"])]),_:1}),d($,{class:"new-reading-btn",onClick:w.resetReading},{default:s(()=>[c("新的解读")]),_:1},8,["onClick"])]),_:1})):l("",!0)]),_:1})}],["__scopeId","data-v-8f58812a"]]);export{D as default};
