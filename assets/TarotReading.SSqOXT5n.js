import{c as t,w as e,i as a,o as s,p as i,a as n,e as r,t as l,x as d,F as o,y as c,q as g,b as h,D as p,u,E as f,l as m}from"./index-smSU8IZZ.js";import{p as I,a as y}from"./ai-insight-service.DUVzQ0fH.js";import{_}from"./_plugin-vue_export-helper.BCo6x5W8.js";const C=_({name:"TarotDrawing",props:{isDrawing:{type:Boolean,default:!1},drawingText:{type:String,default:"正在洗牌..."},drawnCards:{type:Array,default:()=>[]},progress:{type:Number,default:0},cardCount:{type:Number,default:3},showProgressText:{type:Boolean,default:!1}},methods:{startDrawing(){I.start("抽牌动画"),this.$emit("start-drawing")}},updated(){if(this.drawnCards.length===this.cardCount&&!1===this.isDrawing&&I.startTimes["抽牌动画"]){const t=I.end("抽牌动画");console.log(`🃏 抽牌动画完成，耗时: ${t}ms`)}}},[["render",function(u,f,m,I,y,_){const C=a,v=h;return s(),t(C,{class:"tarot-drawing"},{default:e(()=>[m.isDrawing?(s(),t(C,{key:0,class:"drawing-text"},{default:e(()=>[r(l(m.drawingText),1)]),_:1})):i("",!0),n(C,{class:"cards-container"},{default:e(()=>[(s(!0),d(o,null,c(m.cardCount,(a,i)=>(s(),t(C,{class:g(["card-placeholder",{"card-drawn":m.drawnCards.length>i}]),key:i},{default:e(()=>[m.drawnCards.length>i?(s(),t(v,{key:0,class:g(["card-image",{"reversed-image":!1===m.drawnCards[i].isUpright}]),src:m.drawnCards[i].img||"/static/tarot/major/0-愚者.jpg",mode:"aspectFit"},null,8,["src","class"])):(s(),t(C,{key:1,class:"card-number"},{default:e(()=>[r(l(i+1),1)]),_:2},1024))]),_:2},1032,["class"]))),128))]),_:1}),m.isDrawing?(s(),t(C,{key:1,class:"drawing-progress"},{default:e(()=>[n(C,{class:"progress-bar"},{default:e(()=>[n(C,{class:"progress-fill",style:p({width:`${m.progress}%`})},null,8,["style"])]),_:1}),m.showProgressText?(s(),t(C,{key:0,class:"progress-text"},{default:e(()=>[r(l(Math.floor(m.progress))+"%",1)]),_:1})):i("",!0)]),_:1})):i("",!0)]),_:1})}],["__scopeId","data-v-386576cd"]]);const v=_({name:"TarotReading",props:{title:{type:String,default:"塔罗牌解读"},date:{type:String,default:""},cards:{type:Array,default:()=>[]},positions:{type:Array,default:()=>[]},content:{type:String,default:""},isFormatted:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},loadingText:{type:String,default:"正在解读塔罗牌..."},question:{type:String,default:""},showActions:{type:Boolean,default:!0}},data:()=>({activeCardIndex:-1,formattedContent:"",activeMode:"basic",aiInsight:"",formattedAIInsight:"",aiInsightLoading:!1}),watch:{content:{immediate:!0,handler(t){t?this.isFormatted?this.formattedContent=t:this.formatContent(t):this.formattedContent=""}},aiInsight:{handler(t){t&&this.formatAIInsight(t)}}},methods:{setActiveCard(t){this.activeCardIndex=this.activeCardIndex===t?-1:t,this.$emit("card-click",t,this.cards[t])},switchMode(t){this.activeMode=t},async requestAIInsight(){if(this.formattedAIInsight)this.activeMode="ai";else{this.aiInsightLoading=!0,this.activeMode="ai";try{const t=this.cards.map((t,e)=>({name:t.name,isUpright:t.isUpright,uprightMeaning:t.uprightMeaning||"",reversedMeaning:t.reversedMeaning||"",position:this.positions&&this.positions[e]?this.positions[e]:""}));let e="general";this.title&&(this.title.includes("今日")?e="daily":this.title.includes("三张牌")&&(e="three-card"));let a="daily";this.title&&(this.title.includes("快速")?a="quick":this.title.includes("定制")||this.title.includes("定向")?a="custom":this.title.includes("今日")&&(a="daily")),console.log("解读类型:",a),console.log("开始请求AI深度解读，卡牌数据:",t);let s="";"custom"===a&&this.question&&(s=this.question),await y.generateAIInsight(t,e,s,a,this.content,t=>{this.aiInsight=t})}catch(t){console.error("AI解读生成失败:",t),this.aiInsight="AI深度解读失败: 通义千问API调用失败，请配置API密钥",this.formatAIInsight(this.aiInsight)}finally{setTimeout(()=>{this.aiInsightLoading=!1},500)}}},formatAIInsight(t){try{let e=t.replace(/^#\s+(.+)$/gm,"<h3>$1</h3>").replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*([^\*]+)\*/g,"<em>$1</em>").replace(/^(\d+\.\s+)(.*?)$/gm,"<li>$2</li>").replace(/^-\s+(.*?)$/gm,"<li>$1</li>").replace(/\n\n/g,"</p><p>").replace(/\n/g,"<br>");e.startsWith("<p>")||e.startsWith("<h3>")||(e="<p>"+e),e.endsWith("</p>")||(e+="</p>"),e=e.replace(/(<li>.*?<\/li>)+/g,"<ul>$&</ul>"),this.formattedAIInsight=e}catch(e){console.error("格式化AI解读内容出错:",e),this.formattedAIInsight="<p>"+t.replace(/\n/g,"<br>")+"</p>"}},formatContent(t){if(I.start("解读格式化"),!t)return this.formattedContent="",void I.end("解读格式化");try{let e=t.replace(/^#\s+(.+)$/gm,"<h3>$1</h3>").replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*([^\*]+)\*/g,"<em>$1</em>").replace(/^(\d+\.\s+)(.*?)$/gm,"<li>$2</li>").replace(/^-\s+(.*?)$/gm,"<li>$1</li>").replace(/\n\n/g,"</p><p>").replace(/\n/g,"<br>");e.startsWith("<p>")||e.startsWith("<h3>")||(e="<p>"+e),e.endsWith("</p>")||(e+="</p>"),e=e.replace(/(<li>.*?<\/li>)+/g,"<ul>$&</ul>"),this.formattedContent=e;const a=I.end("解读格式化");console.log(`📝 解读格式化完成，耗时: ${a}ms，内容长度: ${t.length}字符`)}catch(e){console.error("格式化解读内容出错:",e),I.end("解读格式化"),this.formattedContent="<p>"+t.replace(/\n/g,"<br>")+"</p>"}}}},[["render",function(p,I,y,_,C,v){const w=a,A=h,$=u,k=m;return s(),t(w,{class:"tarot-reading"},{default:e(()=>[y.title?(s(),t(w,{key:0,class:"reading-header"},{default:e(()=>[n(w,{class:"reading-title"},{default:e(()=>[r(l(y.title),1)]),_:1}),y.date?(s(),t(w,{key:0,class:"reading-date"},{default:e(()=>[r(l(y.date),1)]),_:1})):i("",!0)]),_:1})):i("",!0),y.cards&&y.cards.length>0?(s(),t(w,{key:1,class:"cards-display"},{default:e(()=>[(s(!0),d(o,null,c(y.cards,(a,d)=>(s(),t(w,{class:g(["card-item",{"card-active":C.activeCardIndex===d}]),key:d,onClick:t=>v.setActiveCard(d)},{default:e(()=>[n(A,{class:g(["card-image",{"reversed-image":!1===a.isUpright}]),src:a.img||"/static/tarot/major/0-愚者.jpg",mode:"aspectFit"},null,8,["src","class"]),n(w,{class:"card-name"},{default:e(()=>[r(l(a.name),1)]),_:2},1024),n(w,{class:g(["card-orientation",{reversed:!1===a.isUpright}])},{default:e(()=>[r(l(a.isUpright?"正位":"逆位"),1)]),_:2},1032,["class"]),y.positions&&y.positions[d]?(s(),t(w,{key:0,class:"card-position"},{default:e(()=>[r(l(y.positions[d]),1)]),_:2},1024)):i("",!0)]),_:2},1032,["class","onClick"]))),128))]),_:1})):i("",!0),C.formattedContent&&!y.loading?(s(),t(w,{key:2,class:"reading-mode-tabs"},{default:e(()=>[n(w,{class:g(["mode-tab",{active:"basic"===C.activeMode}]),onClick:I[0]||(I[0]=t=>v.switchMode("basic"))},{default:e(()=>[r(" 基础解读 ")]),_:1},8,["class"]),n(w,{class:g(["mode-tab",{active:"ai"===C.activeMode}]),onClick:v.requestAIInsight},{default:e(()=>[r(" AI深度解读 ")]),_:1},8,["class","onClick"])]),_:1})):i("",!0),n(w,{class:"reading-content"},{default:e(()=>[y.loading&&!C.formattedContent||C.aiInsightLoading&&!C.formattedAIInsight?(s(),t(w,{key:0,class:"loading-indicator"},{default:e(()=>[n(w,{class:"loading-text"},{default:e(()=>[r(l(C.aiInsightLoading?"AI深度解读生成中...":y.loadingText),1)]),_:1}),n(w,{class:"loading-dots"},{default:e(()=>[n(w,{class:"dot"}),n(w,{class:"dot"}),n(w,{class:"dot"})]),_:1})]),_:1})):i("",!0),C.formattedContent&&"basic"===C.activeMode?(s(),t(w,{key:1,class:"reading-text"},{default:e(()=>[n($,{nodes:C.formattedContent},null,8,["nodes"])]),_:1})):i("",!0),C.formattedAIInsight&&"ai"===C.activeMode?(s(),t(w,{key:2,class:"reading-text"},{default:e(()=>[n($,{nodes:C.formattedAIInsight},null,8,["nodes"])]),_:1})):i("",!0)]),_:1}),!y.showActions||y.loading||C.aiInsightLoading?i("",!0):(s(),t(w,{key:3,class:"action-buttons"},{default:e(()=>[f(p.$slots,"actions",{},()=>[n(k,{class:"share-btn",onClick:I[1]||(I[1]=t=>p.$emit("share"))},{default:e(()=>[r("分享解读")]),_:1}),n(k,{class:"save-btn",onClick:I[2]||(I[2]=t=>p.$emit("save"))},{default:e(()=>[r("保存解读")]),_:1})],!0)]),_:3}))]),_:3})}],["__scopeId","data-v-088c40f0"]]);export{v as T,C as a};
