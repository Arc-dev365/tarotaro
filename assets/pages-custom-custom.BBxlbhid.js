import{c as t,w as e,d as s,v as a,b as i,i as n,B as r,o as d,f as o,p as l,k as g,C as c,t as u,j as h}from"./index-D6euLAw-.js";import{s as p,a as R,d as m}from"./share-save-utils.D_HH1R20.js";import{p as w,a as f}from"./ai-insight-service.C3Q3b0vJ.js";import{T as C,a as _}from"./TarotReading.Q5-8oYaX.js";import{_ as D}from"./_plugin-vue_export-helper.BCo6x5W8.js";const v=D({components:{TarotDrawing:_,TarotReading:C},data:()=>({question:"",isDrawing:!1,isReading:!1,drawingProgress:0,drawnCards:[],readingResult:"",formattedReading:"",currentDate:"",cardPositions:["过去/根源","现在/情况","未来/结果"]}),onLoad(){this.setCurrentDate()},onShow(){this.resetReading(),this.isDrawing=!1,this.isReading=!1,this.drawingProgress=0},methods:{setCurrentDate(){const t=new Date,e=t.getFullYear(),s=String(t.getMonth()+1).padStart(2,"0"),a=String(t.getDate()).padStart(2,"0");this.currentDate=`${e}年${s}月${a}日`},startDrawing(){if(!this.question.trim())return void s({title:"请输入你的问题",icon:"none"});this.isDrawing=!0,this.drawingProgress=0,this.drawnCards=[];const t=setInterval(()=>{if(this.drawingProgress+=5,this.drawingProgress>=33&&this.drawnCards.length<1)this.drawnCards.push(m(1)[0]);else if(this.drawingProgress>=66&&this.drawnCards.length<2){const t=this.drawnCards.map(t=>t.id);this.drawnCards.push(m(1,t)[0])}else if(this.drawingProgress>=100){const e=this.drawnCards.map(t=>t.id);this.drawnCards.push(m(1,e)[0]),clearInterval(t),setTimeout(()=>{this.isDrawing=!1,this.startReading()},500)}},100)},startReading(){this.isReading=!0,this.readingResult="",this.formattedReading='<div id="streaming-content"></div>',w.start("解读生成"),this.formatReading(),this.generateReading()},async generateReading(){try{this.formattedReading='<div class="loading-message">正在连接AI服务...</div>';const t=await f.generateAIInsight(this.drawnCards,"threeCard",this.question,"custom","",t=>{this.readingResult=t,this.formatReading()});if(t&&t.includes("很抱歉，解读生成失败"))throw console.error("检测到错误消息:",t),new Error("AI服务生成解读失败");const e=w.end("解读生成");console.log(`✅ 解读生成完成，总耗时: ${e}ms，内容长度: ${t.length}字符`),this.formatReading(),this.saveToRecentReadings(),this.isReading=!1}catch(t){console.error("解读生成失败:",t),w.end("解读生成"),s({title:`AI解读失败: ${t.message}`,icon:"none",duration:3e3}),this.readingResult="",this.formattedReading='<div class="error-message">AI解读生成失败，请稍后重试</div>',this.isReading=!1}},formatReading(){if(w.start("格式化"),!this.readingResult||""===this.readingResult.trim())return this.formattedReading='<div id="streaming-content"></div>',void w.end("格式化");let t=this.readingResult.replace(/^#\s+(.+)$/gm,"<h3>$1</h3>").replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*([^\*]+)\*/g,"<em>$1</em>").replace(/^-\s+(.+)$/gm,"<li>$1</li>").replace(/\n\n/g,"</p><p>").replace(/\n/g,"<br>");t.startsWith("<h3>")||t.startsWith("<p>")||(t="<p>"+t),t.endsWith("</p>")||(t+="</p>"),t=t.replace(/(<li>.*?<\/li>)+/g,"<ul>$&</ul>"),this.formattedReading=t,w.end("格式化")},saveToRecentReadings(){const t=a("recent_readings")||[];t.unshift({id:Date.now().toString(),date:this.currentDate,type:"定向塔罗",question:this.question,cards:this.drawnCards,reading:this.readingResult}),t.length>10&&t.pop(),i("recent_readings",t)},async shareReading(){try{const t={title:"定向塔罗解读",date:this.currentDate,cards:this.drawnCards,content:this.readingResult,question:this.question||"定向解读"};await R(t)}catch(t){console.error("分享失败:",t),s({title:"分享失败",icon:"none",duration:2e3})}},saveReading(){try{const t={title:"定向塔罗解读",date:this.currentDate,cards:this.drawnCards,content:this.readingResult,question:this.question||"定向解读",type:"custom"};p(t)}catch(t){console.error("保存失败:",t),s({title:"保存失败",icon:"none",duration:2e3})}},resetReading(){this.readingResult="",this.drawnCards=[],this.formattedReading="",this.question=""}}},[["render",function(s,a,i,p,R,m){const w=n,f=c,C=h,_=r("TarotDrawing"),D=r("TarotReading");return d(),t(w,{class:"custom-container"},{default:e(()=>[o(w,{class:"header"},{default:e(()=>[o(w,{class:"title"},{default:e(()=>[g("定向塔罗")]),_:1}),o(w,{class:"subtitle"},{default:e(()=>[g("针对特定问题的解读")]),_:1})]),_:1}),R.isDrawing||R.isReading||R.readingResult?l("",!0):(d(),t(w,{key:0,class:"content"},{default:e(()=>[o(w,{class:"instruction"},{default:e(()=>[o(w,{class:"instruction-title"},{default:e(()=>[g("定向塔罗解读")]),_:1}),o(w,{class:"instruction-text"},{default:e(()=>[g("输入你想要解答的问题，通过塔罗牌获取针对性的指引。")]),_:1})]),_:1}),o(w,{class:"question-input"},{default:e(()=>[o(w,{class:"input-label"},{default:e(()=>[g("你的问题")]),_:1}),o(f,{class:"input-area",modelValue:R.question,"onUpdate:modelValue":a[0]||(a[0]=t=>R.question=t),placeholder:"例如：我的事业发展方向如何？我的感情将会有什么变化？",maxlength:"100"},null,8,["modelValue"]),o(w,{class:"input-counter"},{default:e(()=>[g(u(R.question.length)+"/100",1)]),_:1})]),_:1}),o(w,{class:"question-tips"},{default:e(()=>[o(w,{class:"tips-title"},{default:e(()=>[g("提问技巧")]),_:1}),o(w,{class:"tips-list"},{default:e(()=>[o(w,{class:"tip-item"},{default:e(()=>[g("• 使用开放性问题，避免是/否问题")]),_:1}),o(w,{class:"tip-item"},{default:e(()=>[g("• 具体描述你的情况，但不要过于复杂")]),_:1}),o(w,{class:"tip-item"},{default:e(()=>[g("• 关注你能控制的方面，而非他人的想法")]),_:1})]),_:1})]),_:1}),o(C,{class:"start-btn",onClick:m.startDrawing,disabled:!R.question.trim()},{default:e(()=>[g(" 开始抽牌 ")]),_:1},8,["onClick","disabled"])]),_:1})),R.isDrawing?(d(),t(_,{key:1,isDrawing:R.isDrawing,drawingText:"正在洗牌...",drawnCards:R.drawnCards,progress:R.drawingProgress,cardCount:3},null,8,["isDrawing","drawingText","drawnCards","progress"])):l("",!0),R.isReading||R.readingResult?(d(),t(D,{key:2,title:"定向塔罗解读",date:R.currentDate,cards:R.drawnCards,positions:R.cardPositions,content:R.formattedReading,isFormatted:!0,loading:R.isReading,loadingText:"正在解读塔罗牌...",onShare:m.shareReading,onSave:m.saveReading},null,8,["date","cards","positions","content","loading","loadingText","onShare","onSave"])):l("",!0),R.isDrawing||R.isReading||R.readingResult?(d(),t(w,{key:3,class:"question-display"},{default:e(()=>[g(u(R.question),1)]),_:1})):l("",!0),R.readingResult?(d(),t(C,{key:4,class:"new-reading-btn",onClick:m.resetReading},{default:e(()=>[g("新的解读")]),_:1},8,["onClick"])):l("",!0)]),_:1})}],["__scopeId","data-v-530386f9"]]);export{v as default};
